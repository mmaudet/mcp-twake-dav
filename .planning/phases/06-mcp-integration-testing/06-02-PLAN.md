---
phase: 06-mcp-integration-testing
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - README.md
  - LICENSE
autonomous: true

must_haves:
  truths:
    - "New user can set up and run the server by following README instructions"
    - "README documents all environment variables and their purpose"
    - "README includes troubleshooting for common errors"
    - "AGPL-3.0 license file exists at project root"
  artifacts:
    - path: "README.md"
      provides: "Complete setup and usage documentation"
      contains: "DAV_URL"
      min_lines: 80
    - path: "LICENSE"
      provides: "AGPL-3.0 license text"
      contains: "GNU AFFERO GENERAL PUBLIC LICENSE"
  key_links:
    - from: "README.md"
      to: "package.json"
      via: "Installation and build commands reference"
      pattern: "npm install|npm run build|npx mcp-twake"
    - from: "README.md"
      to: "src/config/schema.ts"
      via: "Environment variable documentation matches Zod schema"
      pattern: "DAV_URL.*DAV_USERNAME.*DAV_PASSWORD"
---

<objective>
Create comprehensive README documentation and AGPL-3.0 license file for production-ready distribution.

Purpose: The server has all 9 MCP tools working but lacks any user-facing documentation. A new user needs clear setup instructions, Claude Desktop configuration, environment variable documentation, and troubleshooting guidance to successfully deploy the server. The AGPL-3.0 license is required per LINAGORA standard.

Output: README.md with full setup/usage/troubleshooting docs, LICENSE file with AGPL-3.0 text.
</objective>

<execution_context>
@/Users/mmaudet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mmaudet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/config/schema.ts
@src/index.ts
@src/errors.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create comprehensive README.md</name>
  <files>README.md</files>
  <action>
Create `README.md` at project root with the following sections:

**Header:**
- Project name: mcp-twake
- One-line description: MCP server for querying CalDAV calendars and CardDAV contacts from Claude Desktop
- Badges (optional): License AGPL-3.0

**Overview:**
- What it does: Read-only MCP server enabling Claude to query CalDAV/CardDAV servers
- Compatible with: SabreDAV-based servers (Nextcloud, Twake, etc.)
- Protocol: Model Context Protocol (MCP) over stdio transport
- Sovereign infrastructure: Your data stays on your own servers

**Features:**
- Calendar tools: get_next_event, get_todays_schedule, get_events_in_range, search_events, list_calendars
- Contact tools: search_contacts, get_contact_details, list_contacts, list_addressbooks
- Recurring event expansion (RRULE)
- Multi-calendar and multi-addressbook search
- CTag-based caching for performance
- AI-friendly error messages

**Prerequisites:**
- Node.js >= 18
- A CalDAV/CardDAV server (SabreDAV, Nextcloud, etc.)
- HTTPS required (except localhost for development)
- Claude Desktop or Claude CLI

**Installation:**
```bash
git clone https://github.com/linagora/mcp-twake.git
cd mcp-twake
npm install
npm run build
```

**Configuration — Environment Variables:**
| Variable | Required | Description | Example |
|----------|----------|-------------|---------|
| DAV_URL | Yes | CalDAV/CardDAV server URL (HTTPS required) | https://dav.linagora.com |
| DAV_USERNAME | Yes | Authentication username | user@example.com |
| DAV_PASSWORD | Yes | Authentication password | your-password |
| LOG_LEVEL | No | Log verbosity (default: info) | debug |

**Claude Desktop Configuration:**
Show the claude_desktop_config.json snippet:
```json
{
  "mcpServers": {
    "twake": {
      "command": "node",
      "args": ["/absolute/path/to/mcp-twake/build/index.js"],
      "env": {
        "DAV_URL": "https://dav.example.com",
        "DAV_USERNAME": "user@example.com",
        "DAV_PASSWORD": "your-password"
      }
    }
  }
}
```
Note the config file location:
- macOS: `~/Library/Application Support/Claude/claude_desktop_config.json`
- Linux: `~/.config/Claude/claude_desktop_config.json`
- Windows: `%APPDATA%\Claude\claude_desktop_config.json`

**Usage Examples:**
Show example questions users can ask Claude:
- "What's my next meeting?"
- "What's on my calendar today?"
- "Show my schedule for this week"
- "When is my meeting with Pierre?"
- "Find meetings about budget"
- "What's Marie's email address?"
- "Show Pierre's contact details"
- "List my contacts"
- "What address books do I have?"

**Available Tools (9 total):**
Brief table listing each tool name and what it does.

**Troubleshooting:**
Common issues and fixes:
1. "Configuration validation failed" — Missing env vars, check DAV_URL, DAV_USERNAME, DAV_PASSWORD
2. "Authentication failed" — Wrong credentials, verify username/password
3. "Cannot find server" — DNS issue, check DAV_URL spelling
4. "Connection timed out" — Server unreachable, check network
5. "SSL certificate error" — Self-signed cert, need valid HTTPS
6. "URL must use HTTPS" — HTTP not allowed except localhost
7. "No calendars/contacts found" — Credentials correct but may lack CalDAV/CardDAV permissions
8. Claude Desktop not showing tools — Restart Claude Desktop after config change, check config path

**Development:**
```bash
npm run dev    # Watch mode (TypeScript compilation)
npm run build  # Production build
npm test       # Run tests
```

**Architecture:**
Brief description of the layered architecture:
- Config + Logger (Pino to stderr)
- CalDAV/CardDAV clients (tsdav)
- Services with caching and retry
- MCP tool layer

**License:**
AGPL-3.0 - See LICENSE file. Built by LINAGORA for sovereign infrastructure.

IMPORTANT: Do NOT use emojis anywhere in the README. Use plain text headers and formatting.
  </action>
  <verify>
Verify README.md exists at project root. Check it contains all required sections: Overview, Features, Prerequisites, Installation, Configuration, Claude Desktop Configuration, Usage Examples, Troubleshooting, Development, License. Verify DAV_URL, DAV_USERNAME, DAV_PASSWORD are documented. Verify Claude Desktop config JSON is included with correct file paths.
  </verify>
  <done>
README.md exists with complete setup instructions. A new user can follow the README to install, configure, and use the server with Claude Desktop. All 9 tools documented. Troubleshooting covers common startup errors. No emojis used.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add AGPL-3.0 LICENSE file</name>
  <files>LICENSE</files>
  <action>
Create the `LICENSE` file at project root with the full text of the GNU Affero General Public License version 3 (AGPL-3.0).

Use the standard AGPL-3.0 license text from https://www.gnu.org/licenses/agpl-3.0.txt.

The file should begin with:
```
                    GNU AFFERO GENERAL PUBLIC LICENSE
                       Version 3, 19 November 2007

 Copyright (C) 2007 Free Software Foundation, Inc. <https://fsf.org/>
```

Add a copyright notice at the top or bottom:
```
Copyright (c) 2026 LINAGORA <https://linagora.com>
```

Also verify that package.json already has `"license": "AGPL-3.0"` (it does based on current state).
  </action>
  <verify>
Verify LICENSE file exists at project root. Verify it contains "GNU AFFERO GENERAL PUBLIC LICENSE" and "Version 3". Verify it contains "LINAGORA". Verify package.json has "license": "AGPL-3.0".
  </verify>
  <done>
LICENSE file exists with full AGPL-3.0 text and LINAGORA copyright notice. package.json license field matches.
  </done>
</task>

</tasks>

<verification>
1. README.md exists and contains all documented sections
2. LICENSE file exists with AGPL-3.0 text
3. README references correct env vars matching src/config/schema.ts
4. README Claude Desktop config JSON is syntactically valid
5. No emojis in any file
</verification>

<success_criteria>
- README.md has setup instructions a new user can follow end-to-end
- All 9 MCP tools documented in README
- Claude Desktop configuration documented with correct JSON and file paths
- Troubleshooting section covers 6+ common errors
- AGPL-3.0 LICENSE file at project root with LINAGORA copyright
</success_criteria>

<output>
After completion, create `.planning/phases/06-mcp-integration-testing/06-02-SUMMARY.md`
</output>
